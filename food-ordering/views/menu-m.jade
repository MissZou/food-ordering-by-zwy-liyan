doctype html
html
  head
    meta(charset='UTF-8')
    title Menu
    meta(name='viewport', content='width=device-width, initial-scale=1, user-scalable=no')
    link(rel='stylesheet', href='/stylesheets/header-m.css')
    link(rel='stylesheet', href='/stylesheets/common.css')
    link(rel='stylesheet', href='/stylesheets/menu-m.css')
    link(rel='stylesheet', href='/stylesheets/shop-detail.css')
    style.
      .restaurant-food-price:before{
      content: "\00a5";
      margin-right: 3px;
      font-size: 12px;
      }  
  body
    - if (!Array.prototype.includes) {
    -   Array.prototype.includes = function(searchElement /*, fromIndex*/ ) {
    -     'use strict';
    -     var O = Object(this);
    -     var len = parseInt(O.length) || 0;
    -     if (len === 0) {
    -       return false;
    -     }
    -     var n = parseInt(arguments[1]) || 0;
    -     var k;
    -     if (n >= 0) {
    -       k = n;
    -     } else {
    -       k = len + n;
    -       if (k < 0) {k = 0;}
    -     }
    -     var currentElement;
    -     while (k < len) {
    -       currentElement = O[k];
    -       if (searchElement === currentElement ||(searchElement !== searchElement && currentElement !== currentElement)) {
    -         return true;
    -       }
    -       k++;
    -     }
    -     return false;
    -   };
    - }

    - var values= doc


    //- var values = [{'dishName':'dish1','price':23,'dishPic':'gdrgdrg','category':'lalalasil'}, {'dishName':'dish2','price':23,'dishPic':'www.baidu.com','category':'lalalasil'},{'dishName':'dish3','price':23,'dishPic':'www.baidu.com','category':'lalalasil'},{'dishName':'dish4','price':23,'dishPic':'www.baidu.com','category':'lalalasi4324l'}];
    - var arr=[];
    - for (var i = 0; i < values.length; i++){
    -   if(!arr.includes(values[i].category)){
    -     arr.push(values[i].category);
    - }
    -}


    - Array.prototype.avg=function(key){
    - if(this.length==0){
    - return 0;
    - }
    - var sum=0;
    - var num=this.length;
    - this.forEach(function(cur,ind){
    -   sum+=cur[key];
    - })
    - return sum/num;
    - }

    include header-m.jade
    +header-m("http://www.baidu.com","")
    input#shopName(type="hidden",value= shopName)
    ul.restaurant-tabs.clearfix
      li.restaurant-tab.active Menu
      li.restaurant-tab.comment Comment
      li.restaurant-tab.infoTab Info
    .restaurant-content
      .restaurant-menu
        div.restaurant-menu-item.active
            span.category= arr[0]
        - for (var j = 1; j < arr.length; j++){
          div.restaurant-menu-item
            span.category= arr[j]
        - }
      .restaurant-food
        section
          - for (var i = 0; i < values.length; i++){
          -   if(values[i].category==arr[j]){
            .restaurant-food-container
              img(width='70', height='70', style='opacity: 1; transition: opacity 0.5s;' src= values[i].dishPic)
              .restaurant-food-body
                p.restaurant-food-name= values[i].dishName
                .restaurant-food-content
                  .restaurant-food-info
                    p.restaurant-food-about
                      .star-rating(progress-meter='5')
                        .star-meter(progress-fill=values[i].comment.avg('mark'), style='width:'+values[i].comment.avg('mark')/5.0*100+'%;')
                      span.color-mute= '('+values[i].comment.length+')'
                    .restaurant-food-footer
                      span.restaurant-food-price= values[i].price
                      .mdish-cartcontrol +
                    input(type="hidden" value=values[i]._id class="dishId")
          - }
          - }
          
    a.menu-cart(href='javascript:;')
      .mcart-summary
        span.ui-quantity 0
        span.mcart-price 0
      .mcart-checkout Confirm
  script(src='/javascripts/jquery-2.2.3.min.js')
  script(src='/javascripts/jquery.tmpl.min.js')
  script(src='/javascripts/menu-m.js')
  script(src='/javascripts/header.js')